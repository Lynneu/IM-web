{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, inject, computed, onMounted } from \"vue\";\nimport { useRoute } from 'vue-router';\nexport default {\n  name: \"privateChat\",\n  setup() {\n    const route = useRoute();\n    const friendId = computed(() => route.params.friendId);\n    const text = ref(\"\");\n    const history = ref({\n      messages: []\n    });\n    const socket = inject('socket');\n    const friend = ref(null);\n    const currentUser = JSON.parse(localStorage.getItem('user'));\n    onMounted(() => {\n      console.log('Starting a new conversation with friend', friendId.value);\n    });\n    const sendTextMessage = () => {\n      if (text.value.trim() !== '') {\n        if (socket.instance && socket.instance.readyState === WebSocket.OPEN) {\n          socket.instance.send(JSON.stringify({\n            receiver_id: friendId.value,\n            content: text.value\n          }));\n          text.value = \"\";\n        }\n      }\n    };\n\n    // socket 监听事件应在 mounted 生命周期或者 setup 方法中进行\n    socket.instance.onmessage = event => {\n      console.log(\"Message from server: \", event.data);\n      const receivedMessage = JSON.parse(event.data);\n      console.log(receivedMessage.sender);\n      console.log(friendId.value);\n      // 检查消息的发送者和接收者\n      if (Number(receivedMessage.sender) === Number(friendId.value) || Number(receivedMessage.receiver) === Number(friendId.value)) {\n        history.value.messages.push(receivedMessage);\n      }\n    };\n\n    // 其他逻辑...\n\n    return {\n      text,\n      history,\n      friend,\n      currentUser,\n      sendTextMessage\n    };\n  }\n};","map":{"version":3,"names":["ref","inject","computed","onMounted","useRoute","name","setup","route","friendId","params","text","history","messages","socket","friend","currentUser","JSON","parse","localStorage","getItem","console","log","value","sendTextMessage","trim","instance","readyState","WebSocket","OPEN","send","stringify","receiver_id","content","onmessage","event","data","receivedMessage","sender","Number","receiver","push"],"sources":["/Users/lynneu/Documents/GitHub/im-frontend/src/views/privatechat.vue"],"sourcesContent":["<template>\n  <div class=\"chat-container\">\n    <div class=\"chat-header\">\n      <button @click=\"goBack\">返回</button> <!-- 新增返回按钮 -->\n    </div>\n    <div class=\"chat-main\">\n      <ul class=\"message-list\">\n        <li v-for=\"(item, index) in history.messages\" :key=\"index\" class=\"message-item\" :class=\"{ 'self': item.sender === currentUser.id }\">\n          <div class=\"message-item-content\">\n            <div class=\"message-content\">\n              <div class=\"content-text\">\n                {{item.content}}\n              </div>\n            </div>\n            <div class=\"sender-info\">\n              <span>{{new Date(item.timestamp)}}</span>\n              <span>{{item.sender}}</span>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n    <div class=\"chat-footer\">\n      <div class=\"input-box\">\n        <textarea class=\"input-content\" v-model=\"text\" placeholder=\"请输入消息\"></textarea>\n      </div>\n      <div class=\"send-box\">\n        <button class=\"send-button\" @click=\"sendTextMessage\">发送</button>\n      </div>\n    </div>\n  </div>\n</template>\n\n\n<script>\nimport { ref, inject, computed, onMounted } from \"vue\";\nimport { useRoute } from 'vue-router'\n\nexport default {\n    name: \"privateChat\",\n    setup() {\n        const route = useRoute()\n        const friendId = computed(() => route.params.friendId)\n\n        const text = ref(\"\");\n        const history = ref({ messages: [] });\n        const socket = inject('socket');\n        const friend = ref(null);\n        const currentUser = JSON.parse(localStorage.getItem('user')); \n\n        onMounted(() => {\n            console.log('Starting a new conversation with friend', friendId.value)\n        })\n\n        const sendTextMessage = () => {\n            if(text.value.trim() !== '') {\n                if (socket.instance && socket.instance.readyState === WebSocket.OPEN) {\n                    socket.instance.send(JSON.stringify({\n                        receiver_id: friendId.value,\n                        content: text.value\n                    }));\n                    text.value = \"\";\n                }\n            }\n        }\n\n        // socket 监听事件应在 mounted 生命周期或者 setup 方法中进行\n        socket.instance.onmessage = (event) => {\n            console.log(\"Message from server: \", event.data);\n            const receivedMessage = JSON.parse(event.data);\n            console.log(receivedMessage.sender)\n            console.log(friendId.value)\n            // 检查消息的发送者和接收者\n            if ((Number(receivedMessage.sender) === Number(friendId.value) || \n               Number(receivedMessage.receiver) === Number(friendId.value))) {\n                  history.value.messages.push(receivedMessage);\n}\n\n            \n        };\n\n        // 其他逻辑...\n\n        return {\n            text,\n            history,\n            friend,\n            currentUser,\n            sendTextMessage\n        }\n    }\n}\n</script>\n\n\n\n\n\n\n\n\n<style scoped>\n  .chat-container {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    position: relative;\n  }\n\n  .chat-title {\n    height: 40px;\n    padding: 0 15px;\n    display: flex;\n    align-items: center;\n    font-size: 18px;\n  }\n\n  .chat-avatar {\n    width: 35px;\n    height: 35px;\n  }\n\n  .chat-name {\n    width: 400px;\n    font-size: 15px;\n    margin-left: 10px;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    word-break: break-all;\n  }\n\n  .chat-main {\n    display: flex;\n    flex-direction: column;\n    overflow-y: auto;\n    flex: 1;\n    scrollbar-width: thin;\n  }\n\n  .chat-main::-webkit-scrollbar {\n    width: 0;\n  }\n\n  .chat-main .history-loaded {\n    text-align: center;\n    font-size: 12px;\n    color: #cccccc;\n    line-height: 20px;\n  }\n\n  .chat-main .load {\n    text-align: center;\n    font-size: 12px;\n    color: #d02129;\n    line-height: 20px;\n    cursor: pointer;\n  }\n\n  .history-loading {\n    width: 100%;\n    text-align: center;\n  }\n\n  .time-tips {\n    color: #999;\n    text-align: center;\n    font-size: 12px;\n  }\n\n  .message-list {\n    padding: 0 10px;\n  }\n\n  .message-item {\n    display: flex;\n  }\n\n  .message-item-checkbox {\n    height: 50px;\n    margin-right: 15px;\n    display: flex;\n    align-items: center;\n  }\n\n  .input-checkbox {\n    position: relative;\n  }\n\n  .message-item-checkbox input[type=\"checkbox\"]::before, .message-item-checkbox input[type=\"checkbox\"]:checked::before {\n    content: \"\";\n    position: absolute;\n    top: -3px;\n    left: -3px;\n    background: #FFFFFF;\n    width: 18px;\n    height: 18px;\n    border: 1px solid #cccccc;\n    border-radius: 50%;\n  }\n\n  .message-item-checkbox input[type=\"checkbox\"]:checked::before {\n    content: \"\\2713\";\n    background-color: #d02129;\n    width: 18px;\n    color: #FFFFFF;\n    text-align: center;\n    font-weight: bold;\n  }\n\n  .message-item-content {\n    flex: 1;\n    margin: 5px 0;\n    overflow: hidden;\n    display: flex;\n  }\n\n  .sender-info {\n    margin: 0 5px;\n  }\n\n  .sender-avatar {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n  }\n\n  .message-content {\n    max-width: calc(100% - 100px);\n  }\n\n  .message-payload {\n    display: flex;\n    flex-direction: row;\n    justify-content: flex-end;\n    align-items: center;\n  }\n\n  .pending {\n    background: url(\"../assets/images/pending.gif\") no-repeat center;\n    background-size: 13px;\n    width: 15px;\n    height: 15px;\n  }\n\n  .send-fail {\n    background: url(\"../assets/images/failed.png\") no-repeat center;\n    background-size: 15px;\n    width: 18px;\n    height: 18px;\n    margin-right: 3px;\n  }\n\n  .message-read {\n    color: gray;\n    font-size: 12px;\n    text-align: end;\n    height: 16px;\n  }\n\n  .message-unread {\n    color: #d02129;\n    font-size: 12px;\n    text-align: end;\n    height: 16px;\n  }\n\n  .content-text {\n    display: flex;\n    align-items: center;\n    text-align: left;\n    background: #eeeeee;\n    font-size: 14px;\n    font-weight: 500;\n    padding: 6px 8px;\n    margin: 3px 0;\n    line-height: 25px;\n    white-space: pre-line;\n    overflow-wrap: anywhere;\n    border-radius: 8px;\n    word-break: break-all;\n  }\n\n  .content-image {\n    display: block;\n    cursor: pointer;\n  }\n\n  .content-image img {\n    height: 100%;\n  }\n\n  .content-audio {\n    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n  }\n\n  .content-audio .audio-facade {\n    min-width: 12px;\n    background: #eeeeee;\n    border-radius: 7px;\n    display: flex;\n    font-size: 14px;\n    padding: 8px;\n    margin: 5px 0;\n    line-height: 25px;\n    cursor: pointer;\n  }\n\n  .content-audio .audio-facade-bg {\n    background: url(\"../assets/images/voice.png\") no-repeat center;\n    background-size: 15px;\n    width: 20px;\n  }\n\n  .content-audio .audio-facade-bg.play-icon {\n    background: url(\"../assets/images/play.gif\") no-repeat center;\n    background-size: 20px;\n  }\n\n  .content-order {\n    border-radius: 5px;\n    border: 1px solid #eeeeee;\n    padding: 8px;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .content-order .order-id {\n    font-size: 12px;\n    color: #666666;\n    margin-bottom: 5px;\n  }\n\n  .content-order .order-body {\n    display: flex;\n    font-size: 13px;\n    padding: 5px;\n  }\n\n  .content-order .order-img {\n    width: 70px;\n    height: 70px;\n    border-radius: 5px;\n  }\n\n  .content-order .order-name {\n    margin-left: 10px;\n    width: 135px;\n    color: #606164;\n  }\n\n  .content-order .order-count {\n    font-size: 12px;\n    color: #666666;\n    flex: 1;\n  }\n\n  .content-file {\n    width: 240px;\n    height: 65px;\n    font-size: 15px;\n    background: #FFFFFF;\n    border: 1px solid #eeeeee;\n    display: flex;\n    align-items: center;\n    padding: 10px;\n    border-radius: 5px;\n    cursor: pointer;\n  }\n\n  .content-file:hover {\n    background: #f1f1f1;\n  }\n\n  .file-info {\n    width: 194px;\n    text-align: left;\n  }\n\n  .file-name {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    display: -webkit-box;\n    word-break: break-all;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n  }\n\n  .file-size {\n    font-size: 12px;\n    color: #ccc;\n  }\n\n  .file-img {\n    width: 50px;\n    height: 50px;\n  }\n\n  .message-item .self {\n    overflow: hidden;\n    display: flex;\n    justify-content: flex-start;\n    flex-direction: row-reverse;\n  }\n\n  .message-item .self .audio-facade {\n    flex-direction: row-reverse;\n  }\n\n  .message-item .self .audio-facade-bg {\n    background: url(\"../assets/images/voice.png\") no-repeat center;\n    background-size: 15px;\n    width: 20px;\n    -moz-transform: rotate(180deg);\n    -webkit-transform: rotate(180deg);\n    -o-transform: rotate(180deg);\n    transform: rotate(180deg);\n  }\n\n  .message-item .self .play-icon {\n    background: url(\"../assets/images/play.gif\") no-repeat center;\n    background-size: 20px;\n    -moz-transform: rotate(180deg);\n    -webkit-transform: rotate(180deg);\n    -o-transform: rotate(180deg);\n    transform: rotate(180deg);\n  }\n\n  .message-recalled {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    line-height: 28px;\n    font-size: 13px;\n    text-align: center;\n    color: grey;\n    margin-top: 10px;\n  }\n\n  .message-recalled-self {\n    display: flex;\n  }\n\n  .message-recalled-self span {\n    margin-left: 5px;\n    color: #D02129;\n    cursor: pointer;\n  }\n\n  .chat-footer {\n    border-top: 1px solid #dcdfe6;\n    width: 100%;\n    height: 140px;\n    background: #FFFFFF;\n  }\n\n  .action-delete {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100%;\n    background-color: #FFFFFF;\n  }\n\n  .delete-btn {\n    width: 25px;\n    height: 25px;\n    padding: 10px;\n    background: #f5f5f5;\n    border-radius: 50%;\n    cursor: pointer;\n    margin-bottom: 10px;\n  }\n\n  .action-box {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .action-bar {\n    display: flex;\n    flex-direction: row;\n    padding: 0 10px;\n  }\n\n  .action-bar .action-item {\n    text-align: left;\n    padding: 10px 0;\n    position: relative;\n  }\n\n  .action-bar .action-item .iconfont {\n    font-size: 22px;\n    margin: 0 10px;\n    z-index: 3;\n    color: #606266;\n    cursor: pointer;\n  }\n\n  .action-bar .action-item .iconfont:focus {\n    outline: none;\n  }\n\n  .action-bar .action-item .iconfont:hover {\n    color: #d02129;\n  }\n\n  .emoji-box {\n    width: 210px;\n    position: absolute;\n    top: -111px;\n    left: -11px;\n    z-index: 2007;\n    background: #fff;\n    border: 1px solid #ebeef5;\n    padding: 12px;\n    text-align: justify;\n    font-size: 14px;\n    box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\n    word-break: break-all;\n    border-radius: 4px;\n  }\n\n  .emoji-item {\n    width: 38px;\n    height: 38px;\n    margin: 0 2px;\n  }\n\n  .input-box {\n    padding: 0 10px;\n    flex: 1;\n  }\n\n  .input-content {\n    border: none;\n    resize: none;\n    display: block;\n    padding: 5px 15px;\n    box-sizing: border-box;\n    width: 100%;\n    color: #606266;\n    outline: none;\n    background: #FFFFFF;\n    word-break: break-all;\n  }\n\n  .send-box {\n    padding: 5px 10px;\n    text-align: right;\n  }\n\n  .send-button {\n    width: 70px;\n    height: 30px;\n    font-size: 15px;\n    border: 1px solid #d02129;\n    background-color: #ffffff;\n    color: #d02129;\n    border-radius: 5px;\n  }\n\n  .action-popup {\n    width: 848px;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: -281px;\n    background: rgba(51, 51, 51, 0.5);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n\n  .action-popup-main {\n    width: 150px;\n    height: 120px;\n    background: #ffffff;\n    z-index: 100;\n    border-radius: 10px;\n    overflow: hidden;\n  }\n\n  .action-popup-main .action-item {\n    text-align: center;\n    line-height: 40px;\n    font-size: 15px;\n    color: #262628;\n    border-bottom: 1px solid #efefef;\n    cursor: pointer;\n  }\n\n  .image-preview {\n    max-width: 750px;\n    max-height: 500px;\n    background: rgba(0, 0, 0, 0.8);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: fixed;\n    margin: auto;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 9998;\n  }\n\n  .image-preview img {\n    max-width: 750px;\n    max-height: 500px;\n  }\n\n  .image-preview .close {\n    font-size: 50px;\n    line-height: 24px;\n    cursor: pointer;\n    color: #FFFFFF;\n    position: absolute;\n    top: 10px;\n    right: 5px;\n    z-index: 1002;\n  }\n\n  .order-box {\n    width: 848px;\n    position: absolute;\n    left: -281px;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    z-index: 2007;\n    font-size: 14px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: rgba(33, 33, 33, 0.7);\n  }\n\n  .order-list {\n    width: 300px;\n    background: #F1F1F1;\n    border-radius: 5px;\n  }\n\n  .order-list .title {\n    font-weight: 600;\n    font-size: 15px;\n    color: #000000;\n    margin-left: 10px;\n    margin-right: 10px;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n\n  .order-list .title span {\n    font-size: 28px;\n    font-weight: 400;\n    cursor: pointer;\n  }\n\n  .order-list .order-item {\n    padding: 10px;\n    background: #FFFFFF;\n    margin: 10px;\n    border-radius: 5px;\n    cursor: pointer;\n  }\n\n  .order-list .order-id {\n    font-size: 12px;\n    color: #666666;\n    margin-bottom: 5px;\n  }\n\n  .order-list .order-body {\n    display: flex;\n    font-size: 13px;\n    justify-content: space-between;\n  }\n\n  .order-list .order-img {\n    width: 50px;\n    height: 50px;\n    border-radius: 5px;\n  }\n\n  .order-list .order-name {\n    width: 160px;\n  }\n\n  .order-list .order-count {\n    font-size: 12px;\n    color: #666666;\n    flex: 1;\n  }\n\n</style>"],"mappings":";AAmCA,SAASA,GAAG,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,SAAQ,QAAS,KAAK;AACtD,SAASC,QAAO,QAAS,YAAW;AAEpC,eAAe;EACXC,IAAI,EAAE,aAAa;EACnBC,KAAKA,CAAA,EAAG;IACJ,MAAMC,KAAI,GAAIH,QAAQ,CAAC;IACvB,MAAMI,QAAO,GAAIN,QAAQ,CAAC,MAAMK,KAAK,CAACE,MAAM,CAACD,QAAQ;IAErD,MAAME,IAAG,GAAIV,GAAG,CAAC,EAAE,CAAC;IACpB,MAAMW,OAAM,GAAIX,GAAG,CAAC;MAAEY,QAAQ,EAAE;IAAG,CAAC,CAAC;IACrC,MAAMC,MAAK,GAAIZ,MAAM,CAAC,QAAQ,CAAC;IAC/B,MAAMa,MAAK,GAAId,GAAG,CAAC,IAAI,CAAC;IACxB,MAAMe,WAAU,GAAIC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC;IAE5DhB,SAAS,CAAC,MAAM;MACZiB,OAAO,CAACC,GAAG,CAAC,yCAAyC,EAAEb,QAAQ,CAACc,KAAK;IACzE,CAAC;IAED,MAAMC,eAAc,GAAIA,CAAA,KAAM;MAC1B,IAAGb,IAAI,CAACY,KAAK,CAACE,IAAI,CAAC,MAAM,EAAE,EAAE;QACzB,IAAIX,MAAM,CAACY,QAAO,IAAKZ,MAAM,CAACY,QAAQ,CAACC,UAAS,KAAMC,SAAS,CAACC,IAAI,EAAE;UAClEf,MAAM,CAACY,QAAQ,CAACI,IAAI,CAACb,IAAI,CAACc,SAAS,CAAC;YAChCC,WAAW,EAAEvB,QAAQ,CAACc,KAAK;YAC3BU,OAAO,EAAEtB,IAAI,CAACY;UAClB,CAAC,CAAC,CAAC;UACHZ,IAAI,CAACY,KAAI,GAAI,EAAE;QACnB;MACJ;IACJ;;IAEA;IACAT,MAAM,CAACY,QAAQ,CAACQ,SAAQ,GAAKC,KAAK,IAAK;MACnCd,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEa,KAAK,CAACC,IAAI,CAAC;MAChD,MAAMC,eAAc,GAAIpB,IAAI,CAACC,KAAK,CAACiB,KAAK,CAACC,IAAI,CAAC;MAC9Cf,OAAO,CAACC,GAAG,CAACe,eAAe,CAACC,MAAM;MAClCjB,OAAO,CAACC,GAAG,CAACb,QAAQ,CAACc,KAAK;MAC1B;MACA,IAAKgB,MAAM,CAACF,eAAe,CAACC,MAAM,MAAMC,MAAM,CAAC9B,QAAQ,CAACc,KAAK,KAC1DgB,MAAM,CAACF,eAAe,CAACG,QAAQ,MAAMD,MAAM,CAAC9B,QAAQ,CAACc,KAAK,CAAC,EAAG;QAC3DX,OAAO,CAACW,KAAK,CAACV,QAAQ,CAAC4B,IAAI,CAACJ,eAAe,CAAC;MAC9D;IAGQ,CAAC;;IAED;;IAEA,OAAO;MACH1B,IAAI;MACJC,OAAO;MACPG,MAAM;MACNC,WAAW;MACXQ;IACJ;EACJ;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}