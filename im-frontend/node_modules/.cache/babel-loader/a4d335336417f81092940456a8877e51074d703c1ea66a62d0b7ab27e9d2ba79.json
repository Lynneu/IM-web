{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const router = useRouter();\n    const store = useStore();\n    const user = computed(() => store.state.user); // get user from store\n    const socket = computed(() => store.state.websocket); // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: ''\n    });\n    const friendId = ref(\"\");\n    const friendName = ref(\"\");\n    const message = ref(\"\");\n    const receiveMessage = ref([]);\n    const goToChat = row => {\n      router.push({\n        name: 'privatechat',\n        params: {\n          friendId: row.id,\n          friendName: row.username\n        }\n      });\n    };\n    const fetchFriends = async () => {\n      const userId = user.value.id;\n      console.log('yes');\n      console.log(user.value);\n      console.log(userId);\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`);\n      friends.value = response.data;\n    };\n    const backtoLogin = () => {\n      console.log('logout');\n      console.log(user.value);\n      socket.value.close();\n      store.commit('clearUserState'); // 调用 mutation 来清除用户状态\n      console.log(user.value);\n      router.push({\n        name: 'UserLogin'\n      });\n    };\n    const changeinfo = () => {\n      router.push({\n        name: 'userInfo'\n      });\n    };\n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = event => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n          switch (message.type) {\n            case 'status':\n              {\n                // 更新好友的在线状态\n                const friend = friends.value.find(friend => friend.id === message.content.user_id);\n                if (friend) {\n                  friend.online = message.content.status === 'online';\n                }\n                break;\n              }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data);\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n        socket.value.onclose = event => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://127.0.0.1:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendName.value}`);\n        alert('Friend added successfully');\n        await fetchFriends();\n      } catch (error) {\n        console.error(error);\n      }\n    };\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n    return {\n      friends,\n      registerUser,\n      friendId,\n      friendName,\n      message,\n      receiveMessage,\n      user,\n      // return user\n      socket,\n      // return websocket\n      register,\n      addFriend,\n      sendMessage,\n      backtoLogin,\n      changeinfo,\n      goToChat\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","computed","onMounted","axios","useStore","useRouter","name","setup","router","store","user","state","socket","websocket","friends","registerUser","username","email","password","friendId","friendName","message","receiveMessage","goToChat","row","push","params","id","fetchFriends","userId","value","console","log","response","get","data","backtoLogin","close","commit","changeinfo","onmessage","event","JSON","parse","type","friend","find","content","user_id","online","status","onclose","register","post","error","addFriend","Error","put","alert","sendMessage","trim","readyState","WebSocket","OPEN","send","stringify","receiver_id"],"sources":["/Users/lynneu/Documents/GitHub/IM-web/im-frontend/src/views/helloWorld.vue"],"sourcesContent":["<template>\n  <el-container direction=\"vertical\">\n    <el-header style=\"text-align: right;\">\n      <el-dropdown>\n        <el-button class=\"circular-button\">\n        <span v-if=\"user\" style=\"text-align: center; font-size: large;\">\n          {{ user.username.slice(-1) }}\n          \n        </span>\n      </el-button>\n        <template v-slot:dropdown>\n          <el-dropdown-menu>\n            <el-dropdown-item @click=\"changeinfo\">个人信息\n              <!-- <router-link :to=\"{ name: 'userInfo' }\">个人信息</router-link> -->\n            </el-dropdown-item>\n            <el-dropdown-item @click=\"backtoLogin\">注销</el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </el-header>\n    <el-main>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\">\n          <h2>添加好友</h2>\n          <el-card class=\"box-card\">\n            <el-form @submit.prevent=\"addFriend\">\n              <el-form-item label=\"用户名\">\n                <el-input v-model=\"friendName\" placeholder=\"请输入用户名\"></el-input>\n              </el-form-item>\n              <el-button type=\"primary\" native-type=\"submit\">添加好友</el-button>\n            </el-form>\n          </el-card>\n        </el-col>\n        <el-col :span=\"18\">\n          <h2>好友列表</h2>\n          <el-card class=\"box-card\">\n            <el-table :data=\"friends\" style=\"width: 100%\" @row-click=\"goToChat\">\n              <el-table-column prop=\"username\" label=\"用户名\"></el-table-column>\n              <el-table-column\n                label=\"状态\"\n              >\n                <template #default=\"scope\">\n                  <el-tag :type=\"scope.row.online ? 'success' : 'info'\">{{ scope.row.online ? '在线' : '离线' }}</el-tag>\n                </template>\n              </el-table-column>\n            </el-table>\n          </el-card>\n        </el-col>\n      </el-row>\n    </el-main>\n  </el-container>\n</template>\n\n\n<script>\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\n\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const router = useRouter()\n    const store = useStore()\n    const user = computed(() => store.state.user)  // get user from store\n    const socket = computed(() => store.state.websocket) // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: '',\n    });  \n    const friendId = ref(\"\");\n    const friendName = ref(\"\")\n    const message = ref(\"\");\n    const receiveMessage = ref([])\n\n    const goToChat = (row) => {\n      router.push({\n        name: 'privatechat', \n        params: { \n          friendId: row.id,\n          friendName: row.username \n        }\n      });\n    };\n\n    const fetchFriends = async () => {\n      const userId = user.value.id\n      console.log('yes')\n      console.log(user.value)\n      console.log(userId)\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`)\n      friends.value = response.data\n    }\n    \n    const backtoLogin = () => {\n      console.log('logout')\n      console.log(user.value)\n      socket.value.close()\n      store.commit('clearUserState');  // 调用 mutation 来清除用户状态\n      console.log(user.value)\n      \n      router.push({ name: 'UserLogin' });\n    }\n\n    const changeinfo = () => {\n      router.push({ name: 'userInfo' });\n    }\n\n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = (event) => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n\n          switch (message.type) {\n            case 'status': {\n              // 更新好友的在线状态\n              const friend = friends.value.find(friend => friend.id === message.content.user_id);\n              if (friend) {\n                friend.online = message.content.status === 'online';\n              }\n              break;\n            }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data)\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n  \n        socket.value.onclose = (event) => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://127.0.0.1:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password,\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendName.value}`);\n        alert('Friend added successfully');\n        await fetchFriends(); \n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n\n    return {\n      friends,\n      registerUser,\n      friendId,\n      friendName,\n      message,\n      receiveMessage,\n      user,  // return user\n      socket, // return websocket\n      register,\n      addFriend,\n      sendMessage,\n      backtoLogin,\n      changeinfo,\n      goToChat\n    };\n  },\n};\n</script>\n\n  \n  <style scoped>\n/* .section {\n  margin-bottom: 2rem;\n}\n\n.friend-item, .message-item {\n  border: 1px solid #ccc;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n\n.status-online {\n  color: green;\n}\n\n.status-offline {\n  color: red;\n} */\n\n.el-header {\n  background-color: #337ecc;\n  color: #333;\n  line-height: 60px;\n}\n\n.friend-item {\n  margin-bottom: 15px;\n}\n\n.circular-button {\n  border-radius: 50%; /* 设置圆角为 50%，使按钮形状变为圆形 */\n  width: 50px; /* 可根据需要修改 */\n  height: 50px; /* 可根据需要修改 */\n  display: flex; /* 用于设置按钮中的元素居中 */\n  align-items: center; /* 垂直居中 */\n  justify-content: center; /* 水平居中 */\n  margin: 5px;\n}\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}