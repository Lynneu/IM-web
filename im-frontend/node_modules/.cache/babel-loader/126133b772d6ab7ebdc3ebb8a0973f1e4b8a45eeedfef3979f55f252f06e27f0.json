{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, createTextVNode as _createTextVNode, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0fa23b7a\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"el-dropdown-link\"\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-arrow-down el-icon--right\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Test Chat\", -1 /* HOISTED */));\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"好友列表\", -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_dropdown_item = _resolveComponent(\"el-dropdown-item\");\n  const _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n  const _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n  const _component_el_header = _resolveComponent(\"el-header\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_el_list_item = _resolveComponent(\"el-list-item\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_main = _resolveComponent(\"el-main\");\n  const _component_el_container = _resolveComponent(\"el-container\");\n  return _openBlock(), _createBlock(_component_el_container, {\n    direction: \"vertical\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_header, {\n      style: {\n        \"text-align\": \"right\",\n        \"font-size\": \"20px\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_dropdown, null, {\n        dropdown: _withCtx(() => [_createVNode(_component_el_dropdown_menu, null, {\n          default: _withCtx(() => [_createCommentVNode(\" <el-dropdown-item>\\n              <router-link :to=\\\"{ name: 'userProfile' }\\\">User Profile</router-link>\\n            </el-dropdown-item> \"), _createVNode(_component_el_dropdown_item, null, {\n            default: _withCtx(() => [_createTextVNode(\"Logout\")]),\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        default: _withCtx(() => [_createElementVNode(\"span\", _hoisted_1, [_createTextVNode(_toDisplayString($setup.user.username) + \" \", 1 /* TEXT */), _hoisted_2])]),\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_main, null, {\n      default: _withCtx(() => [_createVNode(_component_el_row, {\n        gutter: 20\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_col, {\n          span: 6\n        }, {\n          default: _withCtx(() => [_hoisted_3, _createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_form, {\n              onSubmit: _withModifiers($setup.addFriend, [\"prevent\"])\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_form_item, {\n                label: \"Friend's ID\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_el_input, {\n                  modelValue: $setup.friendId,\n                  \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.friendId = $event),\n                  placeholder: \"friend's ID\"\n                }, null, 8 /* PROPS */, [\"modelValue\"])]),\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_button, {\n                type: \"primary\",\n                \"native-type\": \"submit\"\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"Add Friend\")]),\n                _: 1 /* STABLE */\n              })]),\n\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"onSubmit\"])]),\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_col, {\n          span: 18\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_hoisted_4, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.friends, (friend, key) => {\n              return _openBlock(), _createBlock(_component_el_list_item, {\n                key: key,\n                class: \"friend-item\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_router_link, {\n                  to: {\n                    name: 'privatechat',\n                    params: {\n                      friendId: friend.id,\n                      friendName: friend.username\n                    }\n                  }\n                }, {\n                  default: _withCtx(() => [_createElementVNode(\"div\", null, [friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 0,\n                    type: \"success\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"在线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), !friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 1,\n                    type: \"info\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"离线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString(friend.username), 1 /* TEXT */)])]),\n\n                  _: 2 /* DYNAMIC */\n                }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"to\"])]),\n                _: 2 /* DYNAMIC */\n              }, 1024 /* DYNAMIC_SLOTS */);\n            }), 128 /* KEYED_FRAGMENT */))]),\n\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["class","_createElementVNode","_createBlock","_component_el_container","direction","_createVNode","_component_el_header","style","_component_el_dropdown","dropdown","_withCtx","_component_el_dropdown_menu","_createCommentVNode","_component_el_dropdown_item","_hoisted_1","$setup","user","username","_hoisted_2","_component_el_main","_component_el_row","gutter","_component_el_col","span","_hoisted_3","_component_el_card","_component_el_form","onSubmit","_withModifiers","addFriend","_component_el_form_item","label","_component_el_input","friendId","$event","placeholder","_component_el_button","type","_hoisted_4","_createElementBlock","_Fragment","_renderList","friends","friend","key","_component_el_list_item","_component_router_link","to","id","online","_component_el_tag","_toDisplayString"],"sources":["/Users/lynneu/Documents/GitHub/IM-web/im-frontend/src/views/helloWorld.vue"],"sourcesContent":["<template>\n  <el-container direction=\"vertical\">\n    <el-header style=\"text-align: right; font-size: 20px;\">\n      <el-dropdown>\n        <span class=\"el-dropdown-link\">\n          {{ user.username }}\n          <i class=\"el-icon-arrow-down el-icon--right\"></i>\n        </span>\n        <template v-slot:dropdown>\n          <el-dropdown-menu>\n            <!-- <el-dropdown-item>\n              <router-link :to=\"{ name: 'userProfile' }\">User Profile</router-link>\n            </el-dropdown-item> -->\n            <el-dropdown-item>Logout</el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </el-header>\n    <el-main>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n          <el-card class=\"box-card\">\n            <el-form @submit.prevent=\"addFriend\">\n              <el-form-item label=\"Friend's ID\">\n                <el-input v-model=\"friendId\" placeholder=\"friend's ID\"></el-input>\n              </el-form-item>\n              <el-button type=\"primary\" native-type=\"submit\">Add Friend</el-button>\n            </el-form>\n          </el-card>\n        </el-col>\n        <el-col :span=\"18\">\n          <el-card class=\"box-card\">\n            <h2>好友列表</h2>\n            <el-list-item \n              v-for=\"(friend, key) in friends\" \n              :key=\"key\" \n              class=\"friend-item\"\n            >\n              <router-link \n                :to=\"{\n                  name: 'privatechat', \n                  params: { \n                    friendId: friend.id,\n                    friendName: friend.username \n                  }\n                }\"\n              >\n                <div>\n                  <el-tag v-if=\"friend.online\" type=\"success\">在线</el-tag>\n                  <el-tag v-if=\"!friend.online\" type=\"info\">离线</el-tag>\n                  {{ friend.username }}\n                </div>\n              </router-link>\n            </el-list-item>\n          </el-card>\n        </el-col>\n      </el-row>\n    </el-main>\n  </el-container>\n</template>\n\n\n\n\n\n\n  \n<script>\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const store = useStore()\n    const user = computed(() => store.state.user)  // get user from store\n    const socket = computed(() => store.state.websocket) // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: '',\n    });  \n    const friendId = ref(\"\");\n    const message = ref(\"\");\n    const receiveMessage = ref([])\n\n    const fetchFriends = async () => {\n      const userId = user.value.id\n      console.log('yes')\n      console.log(user.value)\n      console.log(userId)\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`)\n      friends.value = response.data\n    }\n    \n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = (event) => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n\n          switch (message.type) {\n            case 'status': {\n              // 更新好友的在线状态\n              const friend = friends.value.find(friend => friend.id === message.content.user_id);\n              if (friend) {\n                friend.online = message.content.status === 'online';\n              }\n              break;\n            }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data)\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n  \n        socket.value.onclose = (event) => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://localhost:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password,\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendId.value}`);\n        alert('Friend added successfully');\n        await fetchFriends(); \n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n\n    return {\n      friends,\n      registerUser,\n      friendId,\n      message,\n      receiveMessage,\n      user,  // return user\n      socket, // return websocket\n      register,\n      addFriend,\n      sendMessage,\n    };\n  },\n};\n</script>\n\n  \n  <style scoped>\n/* .section {\n  margin-bottom: 2rem;\n}\n\n.friend-item, .message-item {\n  border: 1px solid #ccc;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n\n.status-online {\n  color: green;\n}\n\n.status-offline {\n  color: red;\n} */\n\n.el-header {\n  background-color: #B3C0D1;\n  color: #333;\n  line-height: 60px;\n}\n\n.friend-item {\n  margin-bottom: 15px;\n}\n\n</style>"],"mappings":";;;EAIcA,KAAK,EAAC;AAAkB;gEAE5BC,mBAAA,CAAiD;EAA9CD,KAAK,EAAC;AAAmC;gEAe5CC,mBAAA,CAAkB,YAAd,WAAS;gEAYXA,mBAAA,CAAa,YAAT,MAAI;;;;;;;;;;;;;;;;;;;uBAhClBC,YAAA,CA0DeC,uBAAA;IA1DDC,SAAS,EAAC;EAAU;sBAChC,MAeY,CAfZC,YAAA,CAeYC,oBAAA;MAfDC,KAA2C,EAA3C;QAAA;QAAA;MAAA;IAA2C;wBACpD,MAac,CAbdF,YAAA,CAacG,sBAAA;QARKC,QAAQ,EAAAC,QAAA,CACvB,MAKmB,CALnBL,YAAA,CAKmBM,2BAAA;4BAJjB,MAEuB,CAFvBC,mBAAA,gJAEuB,EACvBP,YAAA,CAA2CQ,2BAAA;8BAAzB,MAAM,C,iBAAN,QAAM,E;;;;;;;0BAT5B,MAGO,CAHPZ,mBAAA,CAGO,QAHPa,UAGO,G,kCAFFC,MAAA,CAAAC,IAAI,CAACC,QAAQ,IAAG,GACnB,iBAAAC,UAAiD,C;;;;;QAYvDb,YAAA,CAwCUc,kBAAA;wBAvCR,MAsCS,CAtCTd,YAAA,CAsCSe,iBAAA;QAtCAC,MAAM,EAAE;MAAE;0BACjB,MAUS,CAVThB,YAAA,CAUSiB,iBAAA;UAVAC,IAAI,EAAE;QAAC;4BACd,MAAkB,CAAlBC,UAAkB,EAClBnB,YAAA,CAOUoB,kBAAA;YAPDzB,KAAK,EAAC;UAAU;8BACvB,MAKU,CALVK,YAAA,CAKUqB,kBAAA;cALAC,QAAM,EAAAC,cAAA,CAAUb,MAAA,CAAAc,SAAS;;gCACjC,MAEe,CAFfxB,YAAA,CAEeyB,uBAAA;gBAFDC,KAAK,EAAC;cAAa;kCAC/B,MAAkE,CAAlE1B,YAAA,CAAkE2B,mBAAA;8BAA/CjB,MAAA,CAAAkB,QAAQ;6EAARlB,MAAA,CAAAkB,QAAQ,GAAAC,MAAA;kBAAEC,WAAW,EAAC;;;kBAE3C9B,YAAA,CAAqE+B,oBAAA;gBAA1DC,IAAI,EAAC,SAAS;gBAAC,aAAW,EAAC;;kCAAS,MAAU,C,iBAAV,YAAU,E;;;;;;;;;;YAI/DhC,YAAA,CAyBSiB,iBAAA;UAzBAC,IAAI,EAAE;QAAE;4BACf,MAuBU,CAvBVlB,YAAA,CAuBUoB,kBAAA;YAvBDzB,KAAK,EAAC;UAAU;8BACvB,MAAa,CAAbsC,UAAa,G,kBACbC,mBAAA,CAoBeC,SAAA,QAAAC,WAAA,CAnBW1B,MAAA,CAAA2B,OAAO,GAAvBC,MAAM,EAAEC,GAAG;mCADrB1C,YAAA,CAoBe2C,uBAAA;gBAlBZD,GAAG,EAAEA,GAAG;gBACT5C,KAAK,EAAC;;kCAEN,MAcc,CAddK,YAAA,CAccyC,sBAAA;kBAbXC,EAAE;;;gCAAuGJ,MAAM,CAACK,EAAE;kCAAkCL,MAAM,CAAC1B;;;;oCAQ5J,MAIM,CAJNhB,mBAAA,CAIM,cAHU0C,MAAM,CAACM,MAAM,I,cAA3B/C,YAAA,CAAuDgD,iBAAA;;oBAA1Bb,IAAI,EAAC;;sCAAU,MAAE,C,iBAAF,IAAE,E;;4DAC/BM,MAAM,CAACM,MAAM,I,cAA5B/C,YAAA,CAAqDgD,iBAAA;;oBAAvBb,IAAI,EAAC;;sCAAO,MAAE,C,iBAAF,IAAE,E;;4EAAS,GACrD,GAAAc,gBAAA,CAAGR,MAAM,CAAC1B,QAAQ,iB"},"metadata":{},"sourceType":"module","externalDependencies":[]}