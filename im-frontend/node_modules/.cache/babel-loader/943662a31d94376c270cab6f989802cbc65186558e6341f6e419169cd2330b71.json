{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withModifiers as _withModifiers, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0fa23b7a\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Test Chat\", -1 /* HOISTED */));\nconst _hoisted_2 = {\n  class: \"el-dropdown-link\"\n};\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", {\n  class: \"el-icon-arrow-down el-icon--right\"\n}, null, -1 /* HOISTED */));\nconst _hoisted_4 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Test Chat\", -1 /* HOISTED */));\nconst _hoisted_5 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"好友列表\", -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_el_dropdown_item = _resolveComponent(\"el-dropdown-item\");\n  const _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n  const _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_header = _resolveComponent(\"el-header\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_el_list_item = _resolveComponent(\"el-list-item\");\n  const _component_el_main = _resolveComponent(\"el-main\");\n  const _component_el_container = _resolveComponent(\"el-container\");\n  return _openBlock(), _createBlock(_component_el_container, {\n    direction: \"vertical\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_header, null, {\n      default: _withCtx(() => [_createVNode(_component_el_row, {\n        type: \"flex\",\n        justify: \"space-between\",\n        align: \"middle\"\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_col, {\n          span: 6\n        }, {\n          default: _withCtx(() => [_hoisted_1]),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_col, {\n          span: 6,\n          class: \"text-right\"\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_dropdown, null, {\n            default: _withCtx(() => [_createElementVNode(\"span\", _hoisted_2, [_createTextVNode(_toDisplayString($setup.user.username) + \" \", 1 /* TEXT */), _hoisted_3]), _createVNode(_component_el_dropdown_menu, null, {\n              dropdown: _withCtx(() => [_createVNode(_component_el_dropdown_item, null, {\n                default: _withCtx(() => [_createVNode(_component_router_link, {\n                  to: {\n                    name: 'userProfile'\n                  }\n                }, {\n                  default: _withCtx(() => [_createTextVNode(\"User Profile\")]),\n                  _: 1 /* STABLE */\n                })]),\n\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_dropdown_item, null, {\n                default: _withCtx(() => [_createTextVNode(\"Logout\")]),\n                _: 1 /* STABLE */\n              })]),\n\n              _: 1 /* STABLE */\n            })]),\n\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_main, null, {\n      default: _withCtx(() => [_createVNode(_component_el_row, {\n        gutter: 20\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_col, {\n          span: 6\n        }, {\n          default: _withCtx(() => [_hoisted_4, _createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_form, {\n              onSubmit: _withModifiers($setup.addFriend, [\"prevent\"])\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_form_item, {\n                label: \"Friend's ID\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_el_input, {\n                  modelValue: $setup.friendId,\n                  \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.friendId = $event),\n                  placeholder: \"friend's ID\"\n                }, null, 8 /* PROPS */, [\"modelValue\"])]),\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_button, {\n                type: \"primary\",\n                \"native-type\": \"submit\"\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"Add Friend\")]),\n                _: 1 /* STABLE */\n              })]),\n\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"onSubmit\"])]),\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_col, {\n          span: 18\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_hoisted_5, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.friends, (friend, key) => {\n              return _openBlock(), _createBlock(_component_el_list_item, {\n                key: key,\n                class: \"friend-item\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_router_link, {\n                  to: {\n                    name: 'privatechat',\n                    params: {\n                      friendId: friend.id,\n                      friendName: friend.username\n                    }\n                  }\n                }, {\n                  default: _withCtx(() => [_createElementVNode(\"div\", null, [friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 0,\n                    type: \"success\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"在线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), !friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 1,\n                    type: \"info\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"离线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString(friend.username), 1 /* TEXT */)])]),\n\n                  _: 2 /* DYNAMIC */\n                }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"to\"])]),\n                _: 2 /* DYNAMIC */\n              }, 1024 /* DYNAMIC_SLOTS */);\n            }), 128 /* KEYED_FRAGMENT */))]),\n\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["_createElementVNode","class","_createBlock","_component_el_container","direction","_createVNode","_component_el_header","_component_el_row","type","justify","align","_component_el_col","span","_hoisted_1","_component_el_dropdown","_hoisted_2","$setup","user","username","_hoisted_3","_component_el_dropdown_menu","dropdown","_withCtx","_component_el_dropdown_item","_component_router_link","to","name","_component_el_main","gutter","_hoisted_4","_component_el_card","_component_el_form","onSubmit","_withModifiers","addFriend","_component_el_form_item","label","_component_el_input","friendId","$event","placeholder","_component_el_button","_hoisted_5","_createElementBlock","_Fragment","_renderList","friends","friend","key","_component_el_list_item","id","online","_component_el_tag","_toDisplayString"],"sources":["/Users/lynneu/Documents/GitHub/IM-web/im-frontend/src/views/helloWorld.vue"],"sourcesContent":["<template>\n  <el-container direction=\"vertical\">\n    <el-header>\n      <el-row type=\"flex\" justify=\"space-between\" align=\"middle\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n        </el-col>\n        <el-col :span=\"6\" class=\"text-right\">\n          <el-dropdown>\n            <span class=\"el-dropdown-link\">\n              {{ user.username }}\n              <i class=\"el-icon-arrow-down el-icon--right\"></i>\n            </span>\n            <el-dropdown-menu v-slot:dropdown>\n              <el-dropdown-item>\n                <router-link :to=\"{ name: 'userProfile' }\">User Profile</router-link>\n              </el-dropdown-item>\n              <el-dropdown-item>Logout</el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </el-col>\n      </el-row>\n    </el-header>\n    <el-main>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n          <el-card class=\"box-card\">\n            <el-form @submit.prevent=\"addFriend\">\n              <el-form-item label=\"Friend's ID\">\n                <el-input v-model=\"friendId\" placeholder=\"friend's ID\"></el-input>\n              </el-form-item>\n              <el-button type=\"primary\" native-type=\"submit\">Add Friend</el-button>\n            </el-form>\n          </el-card>\n        </el-col>\n        <el-col :span=\"18\">\n          <el-card class=\"box-card\">\n            <h2>好友列表</h2>\n            <el-list-item \n              v-for=\"(friend, key) in friends\" \n              :key=\"key\" \n              class=\"friend-item\"\n            >\n              <router-link \n                :to=\"{\n                  name: 'privatechat', \n                  params: { \n                    friendId: friend.id,\n                    friendName: friend.username \n                  }\n                }\"\n              >\n                <div>\n                  <el-tag v-if=\"friend.online\" type=\"success\">在线</el-tag>\n                  <el-tag v-if=\"!friend.online\" type=\"info\">离线</el-tag>\n                  {{ friend.username }}\n                </div>\n              </router-link>\n            </el-list-item>\n          </el-card>\n        </el-col>\n      </el-row>\n    </el-main>\n  </el-container>\n</template>\n\n\n\n\n\n\n  \n<script>\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const store = useStore()\n    const user = computed(() => store.state.user)  // get user from store\n    const socket = computed(() => store.state.websocket) // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: '',\n    });  \n    const friendId = ref(\"\");\n    const message = ref(\"\");\n    const receiveMessage = ref([])\n\n    const fetchFriends = async () => {\n      const userId = user.value.id\n      console.log('yes')\n      console.log(user.value)\n      console.log(userId)\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`)\n      friends.value = response.data\n    }\n    \n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = (event) => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n\n          switch (message.type) {\n            case 'status': {\n              // 更新好友的在线状态\n              const friend = friends.value.find(friend => friend.id === message.content.user_id);\n              if (friend) {\n                friend.online = message.content.status === 'online';\n              }\n              break;\n            }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data)\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n  \n        socket.value.onclose = (event) => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://localhost:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password,\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendId.value}`);\n        alert('Friend added successfully');\n        await fetchFriends(); \n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n\n    return {\n      friends,\n      registerUser,\n      friendId,\n      message,\n      receiveMessage,\n      user,  // return user\n      socket, // return websocket\n      register,\n      addFriend,\n      sendMessage,\n    };\n  },\n};\n</script>\n\n  \n  <style scoped>\n/* .section {\n  margin-bottom: 2rem;\n}\n\n.friend-item, .message-item {\n  border: 1px solid #ccc;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n\n.status-online {\n  color: green;\n}\n\n.status-offline {\n  color: red;\n} */\n\n.el-header {\n  background-color: #b3c0d1;\n  color: #333;\n  line-height: 60px;\n}\n\n.text-right {\n  text-align: right;\n  padding-right: 20px;\n}\n\n.friend-item {\n  margin-bottom: 15px;\n}\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}