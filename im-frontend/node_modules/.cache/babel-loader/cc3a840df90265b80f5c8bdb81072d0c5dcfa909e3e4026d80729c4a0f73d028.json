{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex';\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const store = useStore();\n    const user = computed(() => store.state.user); // get user from store\n    const socket = computed(() => store.state.websocket); // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: ''\n    });\n    const friendId = ref(\"\");\n    const message = ref(\"\");\n    const receiveMessage = ref([]);\n    const fetchFriends = async () => {\n      const userId = user.value.id;\n      console.log('yes');\n      console.log(user.value);\n      console.log(userId);\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`);\n      friends.value = response.data;\n    };\n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = event => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n          switch (message.type) {\n            case 'status':\n              {\n                // 更新好友的在线状态\n                const friend = friends.value.find(friend => friend.id === message.content.user_id);\n                if (friend) {\n                  friend.online = message.content.status === 'online';\n                }\n                break;\n              }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data);\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n        socket.value.onclose = event => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://localhost:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendId.value}`);\n        alert('Friend added successfully');\n        await fetchFriends();\n      } catch (error) {\n        console.error(error);\n      }\n    };\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n    return {\n      friends,\n      registerUser,\n      friendId,\n      message,\n      receiveMessage,\n      user,\n      // return user\n      socket,\n      // return websocket\n      register,\n      addFriend,\n      sendMessage\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","computed","onMounted","axios","useStore","name","setup","store","user","state","socket","websocket","friends","registerUser","username","email","password","friendId","message","receiveMessage","fetchFriends","userId","value","id","console","log","response","get","data","onmessage","event","JSON","parse","type","friend","find","content","user_id","online","status","push","onclose","register","post","error","addFriend","Error","put","alert","sendMessage","trim","readyState","WebSocket","OPEN","send","stringify","receiver_id"],"sources":["/Users/lynneu/Documents/GitHub/IM-web/im-frontend/src/views/helloWorld.vue"],"sourcesContent":["<template>\n  <el-container direction=\"vertical\">\n    <el-header>\n      <el-row type=\"flex\" justify=\"space-between\" align=\"middle\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n        </el-col>\n        <el-col :span=\"6\" class=\"text-right\">\n          <el-dropdown>\n            <span class=\"el-dropdown-link\">\n              {{ user.username }}\n              <i class=\"el-icon-arrow-down el-icon--right\"></i>\n            </span>\n            <el-dropdown-menu v-slot:dropdown>\n              <!-- <el-dropdown-item>\n                <router-link :to=\"{ name: 'userProfile' }\">User Profile</router-link>\n              </el-dropdown-item> -->\n              <el-dropdown-item>Logout</el-dropdown-item>\n            </el-dropdown-menu>\n          </el-dropdown>\n        </el-col>\n      </el-row>\n    </el-header>\n    <el-main>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n          <el-card class=\"box-card\">\n            <el-form @submit.prevent=\"addFriend\">\n              <el-form-item label=\"Friend's ID\">\n                <el-input v-model=\"friendId\" placeholder=\"friend's ID\"></el-input>\n              </el-form-item>\n              <el-button type=\"primary\" native-type=\"submit\">Add Friend</el-button>\n            </el-form>\n          </el-card>\n        </el-col>\n        <el-col :span=\"18\">\n          <el-card class=\"box-card\">\n            <h2>好友列表</h2>\n            <el-list-item \n              v-for=\"(friend, key) in friends\" \n              :key=\"key\" \n              class=\"friend-item\"\n            >\n              <router-link \n                :to=\"{\n                  name: 'privatechat', \n                  params: { \n                    friendId: friend.id,\n                    friendName: friend.username \n                  }\n                }\"\n              >\n                <div>\n                  <el-tag v-if=\"friend.online\" type=\"success\">在线</el-tag>\n                  <el-tag v-if=\"!friend.online\" type=\"info\">离线</el-tag>\n                  {{ friend.username }}\n                </div>\n              </router-link>\n            </el-list-item>\n          </el-card>\n        </el-col>\n      </el-row>\n    </el-main>\n  </el-container>\n</template>\n\n\n\n\n\n\n  \n<script>\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex'\n\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const store = useStore()\n    const user = computed(() => store.state.user)  // get user from store\n    const socket = computed(() => store.state.websocket) // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: '',\n    });  \n    const friendId = ref(\"\");\n    const message = ref(\"\");\n    const receiveMessage = ref([])\n\n    const fetchFriends = async () => {\n      const userId = user.value.id\n      console.log('yes')\n      console.log(user.value)\n      console.log(userId)\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`)\n      friends.value = response.data\n    }\n    \n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = (event) => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n\n          switch (message.type) {\n            case 'status': {\n              // 更新好友的在线状态\n              const friend = friends.value.find(friend => friend.id === message.content.user_id);\n              if (friend) {\n                friend.online = message.content.status === 'online';\n              }\n              break;\n            }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data)\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n  \n        socket.value.onclose = (event) => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://localhost:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password,\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendId.value}`);\n        alert('Friend added successfully');\n        await fetchFriends(); \n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n\n    return {\n      friends,\n      registerUser,\n      friendId,\n      message,\n      receiveMessage,\n      user,  // return user\n      socket, // return websocket\n      register,\n      addFriend,\n      sendMessage,\n    };\n  },\n};\n</script>\n\n  \n  <style scoped>\n/* .section {\n  margin-bottom: 2rem;\n}\n\n.friend-item, .message-item {\n  border: 1px solid #ccc;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n\n.status-online {\n  color: green;\n}\n\n.status-offline {\n  color: red;\n} */\n\n.el-header {\n  background-color: #b3c0d1;\n  color: #333;\n  line-height: 60px;\n}\n\n.text-right {\n  text-align: right;\n  padding-right: 20px;\n}\n\n.friend-item {\n  margin-bottom: 15px;\n}\n\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}