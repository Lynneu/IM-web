{"ast":null,"code":"import { toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, withModifiers as _withModifiers, renderList as _renderList, Fragment as _Fragment, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-0fa23b7a\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  key: 0\n};\nconst _hoisted_2 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"Test Chat\", -1 /* HOISTED */));\nconst _hoisted_3 = /*#__PURE__*/_withScopeId(() => /*#__PURE__*/_createElementVNode(\"h2\", null, \"好友列表\", -1 /* HOISTED */));\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_arrow_down = _resolveComponent(\"arrow-down\");\n  const _component_el_icon = _resolveComponent(\"el-icon\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_dropdown_item = _resolveComponent(\"el-dropdown-item\");\n  const _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n  const _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n  const _component_el_header = _resolveComponent(\"el-header\");\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  const _component_el_card = _resolveComponent(\"el-card\");\n  const _component_el_col = _resolveComponent(\"el-col\");\n  const _component_el_tag = _resolveComponent(\"el-tag\");\n  const _component_router_link = _resolveComponent(\"router-link\");\n  const _component_el_list_item = _resolveComponent(\"el-list-item\");\n  const _component_el_row = _resolveComponent(\"el-row\");\n  const _component_el_main = _resolveComponent(\"el-main\");\n  const _component_el_container = _resolveComponent(\"el-container\");\n  return _openBlock(), _createBlock(_component_el_container, {\n    direction: \"vertical\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_header, {\n      style: {\n        \"text-align\": \"right\"\n      }\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_dropdown, null, {\n        dropdown: _withCtx(() => [_createVNode(_component_el_dropdown_menu, null, {\n          default: _withCtx(() => [_createVNode(_component_el_dropdown_item, {\n            onClick: $setup.changeinfo\n          }, {\n            default: _withCtx(() => [_createTextVNode(\"个人信息 \"), _createCommentVNode(\" <router-link :to=\\\"{ name: 'userInfo' }\\\">个人信息</router-link> \")]),\n            _: 1 /* STABLE */\n          }, 8 /* PROPS */, [\"onClick\"]), _createVNode(_component_el_dropdown_item, {\n            onClick: $setup.backtoLogin\n          }, {\n            default: _withCtx(() => [_createTextVNode(\"注销\")]),\n            _: 1 /* STABLE */\n          }, 8 /* PROPS */, [\"onClick\"])]),\n          _: 1 /* STABLE */\n        })]),\n\n        default: _withCtx(() => [_createVNode(_component_el_button, {\n          type: \"primary\",\n          class: \"el-dropdown-link\"\n        }, {\n          default: _withCtx(() => [$setup.user ? (_openBlock(), _createElementBlock(\"span\", _hoisted_1, [_createTextVNode(_toDisplayString($setup.user.username) + \" \", 1 /* TEXT */), _createVNode(_component_el_icon, {\n            class: \"el-icon--right\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_arrow_down)]),\n            _: 1 /* STABLE */\n          })])) : _createCommentVNode(\"v-if\", true)]),\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_main, null, {\n      default: _withCtx(() => [_createVNode(_component_el_row, {\n        gutter: 20\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_col, {\n          span: 6\n        }, {\n          default: _withCtx(() => [_hoisted_2, _createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_createVNode(_component_el_form, {\n              onSubmit: _withModifiers($setup.addFriend, [\"prevent\"])\n            }, {\n              default: _withCtx(() => [_createVNode(_component_el_form_item, {\n                label: \"Friend's ID\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_el_input, {\n                  modelValue: $setup.friendName,\n                  \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.friendName = $event),\n                  placeholder: \"friend's ID\"\n                }, null, 8 /* PROPS */, [\"modelValue\"])]),\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_button, {\n                type: \"primary\",\n                \"native-type\": \"submit\"\n              }, {\n                default: _withCtx(() => [_createTextVNode(\"Add Friend\")]),\n                _: 1 /* STABLE */\n              })]),\n\n              _: 1 /* STABLE */\n            }, 8 /* PROPS */, [\"onSubmit\"])]),\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_col, {\n          span: 18\n        }, {\n          default: _withCtx(() => [_createVNode(_component_el_card, {\n            class: \"box-card\"\n          }, {\n            default: _withCtx(() => [_hoisted_3, (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.friends, (friend, key) => {\n              return _openBlock(), _createBlock(_component_el_list_item, {\n                key: key,\n                class: \"friend-item\"\n              }, {\n                default: _withCtx(() => [_createVNode(_component_router_link, {\n                  to: {\n                    name: 'privatechat',\n                    params: {\n                      friendId: friend.id,\n                      friendName: friend.username\n                    }\n                  }\n                }, {\n                  default: _withCtx(() => [_createElementVNode(\"div\", null, [friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 0,\n                    type: \"success\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"在线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), !friend.online ? (_openBlock(), _createBlock(_component_el_tag, {\n                    key: 1,\n                    type: \"info\"\n                  }, {\n                    default: _withCtx(() => [_createTextVNode(\"离线\")]),\n                    _: 1 /* STABLE */\n                  })) : _createCommentVNode(\"v-if\", true), _createTextVNode(\" \" + _toDisplayString(friend.username), 1 /* TEXT */)])]),\n\n                  _: 2 /* DYNAMIC */\n                }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"to\"])]),\n                _: 2 /* DYNAMIC */\n              }, 1024 /* DYNAMIC_SLOTS */);\n            }), 128 /* KEYED_FRAGMENT */))]),\n\n            _: 1 /* STABLE */\n          })]),\n\n          _: 1 /* STABLE */\n        })]),\n\n        _: 1 /* STABLE */\n      })]),\n\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  });\n}","map":{"version":3,"names":["_createElementVNode","_createBlock","_component_el_container","direction","_createVNode","_component_el_header","style","_component_el_dropdown","dropdown","_withCtx","_component_el_dropdown_menu","_component_el_dropdown_item","onClick","$setup","changeinfo","_createCommentVNode","backtoLogin","_component_el_button","type","class","user","_createElementBlock","_hoisted_1","username","_component_el_icon","_component_arrow_down","_component_el_main","_component_el_row","gutter","_component_el_col","span","_hoisted_2","_component_el_card","_component_el_form","onSubmit","_withModifiers","addFriend","_component_el_form_item","label","_component_el_input","friendName","$event","placeholder","_hoisted_3","_Fragment","_renderList","friends","friend","key","_component_el_list_item","_component_router_link","to","id","online","_component_el_tag","_toDisplayString"],"sources":["/Users/lynneu/Documents/GitHub/IM-web/im-frontend/src/views/helloWorld.vue"],"sourcesContent":["<template>\n  <el-container direction=\"vertical\">\n    <el-header style=\"text-align: right;\">\n      <el-dropdown>\n        <el-button type=\"primary\" class=\"el-dropdown-link\">\n        <span v-if=\"user\">\n          {{ user.username }}\n          <el-icon class=\"el-icon--right\"><arrow-down /></el-icon>\n        </span>\n      </el-button>\n        <template v-slot:dropdown>\n          <el-dropdown-menu>\n            <el-dropdown-item @click=\"changeinfo\">个人信息\n              <!-- <router-link :to=\"{ name: 'userInfo' }\">个人信息</router-link> -->\n            </el-dropdown-item>\n            <el-dropdown-item @click=\"backtoLogin\">注销</el-dropdown-item>\n          </el-dropdown-menu>\n        </template>\n      </el-dropdown>\n    </el-header>\n    <el-main>\n      <el-row :gutter=\"20\">\n        <el-col :span=\"6\">\n          <h2>Test Chat</h2>\n          <el-card class=\"box-card\">\n            <el-form @submit.prevent=\"addFriend\">\n              <el-form-item label=\"Friend's ID\">\n                <el-input v-model=\"friendName\" placeholder=\"friend's ID\"></el-input>\n              </el-form-item>\n              <el-button type=\"primary\" native-type=\"submit\">Add Friend</el-button>\n            </el-form>\n          </el-card>\n        </el-col>\n        <el-col :span=\"18\">\n          <el-card class=\"box-card\">\n            <h2>好友列表</h2>\n            <el-list-item \n              v-for=\"(friend, key) in friends\" \n              :key=\"key\" \n              class=\"friend-item\"\n            >\n              <router-link \n                :to=\"{\n                  name: 'privatechat', \n                  params: { \n                    friendId: friend.id,\n                    friendName: friend.username \n                  }\n                }\"\n              >\n                <div>\n                  <el-tag v-if=\"friend.online\" type=\"success\">在线</el-tag>\n                  <el-tag v-if=\"!friend.online\" type=\"info\">离线</el-tag>\n                  {{ friend.username }}\n                </div>\n              </router-link>\n            </el-list-item>\n          </el-card>\n        </el-col>\n      </el-row>\n    </el-main>\n  </el-container>\n</template>\n\n\n<script>\nimport { ref, reactive, computed, onMounted } from \"vue\";\nimport axios from 'axios';\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\n\nexport default {\n  name: 'HelloWorld',\n  setup() {\n    const router = useRouter()\n    const store = useStore()\n    const user = computed(() => store.state.user)  // get user from store\n    const socket = computed(() => store.state.websocket) // get websocket from store\n    const friends = ref([]);\n    const registerUser = reactive({\n      username: '',\n      email: '',\n      password: '',\n    });  \n    const friendId = ref(\"\");\n    const friendName = ref(\"\")\n    const message = ref(\"\");\n    const receiveMessage = ref([])\n\n    const fetchFriends = async () => {\n      const userId = user.value.id\n      console.log('yes')\n      console.log(user.value)\n      console.log(userId)\n      const response = await axios.get(`http://localhost:8000/users/${userId}/friends`)\n      friends.value = response.data\n    }\n    \n    const backtoLogin = () => {\n      console.log('logout')\n      console.log(user.value)\n      socket.value.close()\n      store.commit('clearUserState');  // 调用 mutation 来清除用户状态\n      console.log(user.value)\n      \n      router.push({ name: 'UserLogin' });\n    }\n\n    const changeinfo = () => {\n      router.push({ name: 'userInfo' });\n    }\n\n    onMounted(async () => {\n      await fetchFriends();\n      if (socket.value) {\n        socket.value.onmessage = (event) => {\n          console.log(\"Message from server: \", event.data);\n          const message = JSON.parse(event.data);\n\n          switch (message.type) {\n            case 'status': {\n              // 更新好友的在线状态\n              const friend = friends.value.find(friend => friend.id === message.content.user_id);\n              if (friend) {\n                friend.online = message.content.status === 'online';\n              }\n              break;\n            }\n            case 'text':\n              // Handle received messages as before\n              receiveMessage.value.push(event.data)\n              break;\n            default:\n              console.log(\"Unknown message type:\", message.type);\n          }\n        };\n  \n        socket.value.onclose = (event) => {\n          console.log(\"Socket closed\", event);\n        };\n      }\n    });\n\n    const register = async () => {\n      try {\n        const response = await axios.post(\"http://localhost:8000/users/\", {\n          username: registerUser.username,\n          email: registerUser.email,\n          password: registerUser.password,\n        });\n        console.log(response.data);\n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const addFriend = async () => {\n      try {\n        if (!user.value) {\n          throw new Error('User not logged in');\n        }\n        await axios.put(`http://localhost:8000/users/${user.value.id}/friends/${friendName.value}`);\n        alert('Friend added successfully');\n        await fetchFriends(); \n      } catch (error) {\n        console.error(error);\n      }\n    };\n\n    const sendMessage = () => {\n      if (message.value.trim() !== '' && socket.value && socket.value.readyState === WebSocket.OPEN) {\n        console.log(message.value);\n        socket.value.send(JSON.stringify({\n          receiver_id: friendId.value,\n          content: message.value\n        }));\n        message.value = \"\";\n      }\n    };\n\n    return {\n      friends,\n      registerUser,\n      friendId,\n      friendName,\n      message,\n      receiveMessage,\n      user,  // return user\n      socket, // return websocket\n      register,\n      addFriend,\n      sendMessage,\n      backtoLogin,\n      changeinfo\n    };\n  },\n};\n</script>\n\n  \n  <style scoped>\n/* .section {\n  margin-bottom: 2rem;\n}\n\n.friend-item, .message-item {\n  border: 1px solid #ccc;\n  padding: 1rem;\n  margin-bottom: 1rem;\n}\n\n.status-online {\n  color: green;\n}\n\n.status-offline {\n  color: red;\n} */\n\n.el-header {\n  background-color: #B3C0D1;\n  color: #333;\n  line-height: 60px;\n}\n\n.friend-item {\n  margin-bottom: 15px;\n}\n.el-dropdown-link {\n  \n  padding: 20px;      /* 设置内边距 */\n}\n\n</style>"],"mappings":";;;;;gEAuBUA,mBAAA,CAAkB,YAAd,WAAS;gEAYXA,mBAAA,CAAa,YAAT,MAAI;;;;;;;;;;;;;;;;;;;;;uBAlClBC,YAAA,CA4DeC,uBAAA;IA5DDC,SAAS,EAAC;EAAU;sBAChC,MAiBY,CAjBZC,YAAA,CAiBYC,oBAAA;MAjBDC,KAA0B,EAA1B;QAAA;MAAA;IAA0B;wBACnC,MAec,CAfdF,YAAA,CAecG,sBAAA;QARKC,QAAQ,EAAAC,QAAA,CACvB,MAKmB,CALnBL,YAAA,CAKmBM,2BAAA;4BAJjB,MAEmB,CAFnBN,YAAA,CAEmBO,2BAAA;YAFAC,OAAK,EAAEC,MAAA,CAAAC;UAAU;8BAAE,MACpC,C,iBADoC,OACpC,GAAAC,mBAAA,kEAAmE,C;;0CAErEX,YAAA,CAA4DO,2BAAA;YAAzCC,OAAK,EAAEC,MAAA,CAAAG;UAAW;8BAAE,MAAE,C,iBAAF,IAAE,E;;;;;;0BAX7C,MAKU,CALVZ,YAAA,CAKUa,oBAAA;UALCC,IAAI,EAAC,SAAS;UAACC,KAAK,EAAC;;4BAChC,MAGO,CAHKN,MAAA,CAAAO,IAAI,I,cAAhBC,mBAAA,CAGO,QAAAC,UAAA,G,kCAFFT,MAAA,CAAAO,IAAI,CAACG,QAAQ,IAAG,GACnB,iBAAAnB,YAAA,CAAwDoB,kBAAA;YAA/CL,KAAK,EAAC;UAAgB;8BAAC,MAAc,CAAdf,YAAA,CAAcqB,qBAAA,E;;;;;;;;;;QAapDrB,YAAA,CAwCUsB,kBAAA;wBAvCR,MAsCS,CAtCTtB,YAAA,CAsCSuB,iBAAA;QAtCAC,MAAM,EAAE;MAAE;0BACjB,MAUS,CAVTxB,YAAA,CAUSyB,iBAAA;UAVAC,IAAI,EAAE;QAAC;4BACd,MAAkB,CAAlBC,UAAkB,EAClB3B,YAAA,CAOU4B,kBAAA;YAPDb,KAAK,EAAC;UAAU;8BACvB,MAKU,CALVf,YAAA,CAKU6B,kBAAA;cALAC,QAAM,EAAAC,cAAA,CAAUtB,MAAA,CAAAuB,SAAS;;gCACjC,MAEe,CAFfhC,YAAA,CAEeiC,uBAAA;gBAFDC,KAAK,EAAC;cAAa;kCAC/B,MAAoE,CAApElC,YAAA,CAAoEmC,mBAAA;8BAAjD1B,MAAA,CAAA2B,UAAU;6EAAV3B,MAAA,CAAA2B,UAAU,GAAAC,MAAA;kBAAEC,WAAW,EAAC;;;kBAE7CtC,YAAA,CAAqEa,oBAAA;gBAA1DC,IAAI,EAAC,SAAS;gBAAC,aAAW,EAAC;;kCAAS,MAAU,C,iBAAV,YAAU,E;;;;;;;;;;YAI/Dd,YAAA,CAyBSyB,iBAAA;UAzBAC,IAAI,EAAE;QAAE;4BACf,MAuBU,CAvBV1B,YAAA,CAuBU4B,kBAAA;YAvBDb,KAAK,EAAC;UAAU;8BACvB,MAAa,CAAbwB,UAAa,G,kBACbtB,mBAAA,CAoBeuB,SAAA,QAAAC,WAAA,CAnBWhC,MAAA,CAAAiC,OAAO,GAAvBC,MAAM,EAAEC,GAAG;mCADrB/C,YAAA,CAoBegD,uBAAA;gBAlBZD,GAAG,EAAEA,GAAG;gBACT7B,KAAK,EAAC;;kCAEN,MAcc,CAddf,YAAA,CAcc8C,sBAAA;kBAbXC,EAAE;;;gCAAuGJ,MAAM,CAACK,EAAE;kCAAkCL,MAAM,CAACxB;;;;oCAQ5J,MAIM,CAJNvB,mBAAA,CAIM,cAHU+C,MAAM,CAACM,MAAM,I,cAA3BpD,YAAA,CAAuDqD,iBAAA;;oBAA1BpC,IAAI,EAAC;;sCAAU,MAAE,C,iBAAF,IAAE,E;;4DAC/B6B,MAAM,CAACM,MAAM,I,cAA5BpD,YAAA,CAAqDqD,iBAAA;;oBAAvBpC,IAAI,EAAC;;sCAAO,MAAE,C,iBAAF,IAAE,E;;4EAAS,GACrD,GAAAqC,gBAAA,CAAGR,MAAM,CAACxB,QAAQ,iB"},"metadata":{},"sourceType":"module","externalDependencies":[]}