{"ast":null,"code":"import { reactive, ref, toRefs, onMounted } from 'vue';\nimport { version } from '../../package.json';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'Login',\n  setup() {\n    const router = useRouter();\n    const state = reactive({\n      version: version,\n      username: '',\n      password: {\n        visible: false,\n        value: ''\n      },\n      errorVisible: false,\n      globalData: {\n        currentUser: null\n      }\n    });\n    onMounted(() => {});\n    const switchPasswordVisible = () => {\n      state.password.visible = !state.password.visible;\n    };\n    const login = async () => {\n      if (state.username.trim() !== '' && state.password.value.trim() !== '') {\n        try {\n          const response = await axios.post(\"http://localhost:8000/login\", {\n            username: username,\n            password: password.value\n          });\n          console.log(response.data);\n          localStorage.setItem('user', JSON.stringify(response.data));\n          connectSocket(response.data.id);\n          router.replace({\n            path: './conversations'\n          });\n        } catch (error) {\n          state.errorVisible = true;\n        }\n      }\n    };\n    const connectSocket = userId => {\n      socket = new WebSocket(\"ws://localhost:8000/ws/\" + userId);\n      socket.onopen = () => {\n        console.log(\"success!\");\n      };\n      socket.onmessage = event => {\n        console.log(\"Message from server: \", event.data);\n        receiveMessage.value += event.data;\n      };\n      socket.onclose = event => {\n        console.log(\"Socket closed\", event);\n      };\n    };\n    return {\n      ...toRefs(state),\n      switchPasswordVisible,\n      login\n    };\n  }\n};","map":{"version":3,"names":["reactive","ref","toRefs","onMounted","version","useRouter","name","setup","router","state","username","password","visible","value","errorVisible","globalData","currentUser","switchPasswordVisible","login","trim","response","axios","post","console","log","data","localStorage","setItem","JSON","stringify","connectSocket","id","replace","path","error","userId","socket","WebSocket","onopen","onmessage","event","receiveMessage","onclose"],"sources":["/Users/lynneu/Documents/GitHub/im-frontend/src/views/login.vue"],"sourcesContent":["<template>\n    <div class=\"login\">\n      <div class=\"login-container\">\n        <div class=\"login-main\">\n          <div class=\"login-header\">\n            <div>登录</div>\n          </div>\n          <div class=\"login-form\">\n            <div class=\"form-item\">\n              <input v-model=\"username\" class=\"password-input\" placeholder=\"请输入用户名\"/>\n            </div>\n            <div class=\"form-item\">\n              <input v-model=\"password.value\" class=\"password-input\" placeholder=\"请输入密码\" :type=\"password.visible ? 'text':'password'\"/>\n              <img class=\"password-image\" @click=\"switchPasswordVisible\" src=\"../assets/images/visible.png\"/>\n            </div>\n            <div class=\"form-item\">\n              <button class=\"form-item-btn\" @click=\"login\">登录</button>\n            </div>\n            <div v-show=\"errorVisible\" class=\"form-error\">账号或密码错误!</div>\n          </div>\n          <div class=\"version\">{{ version }}</div>\n        </div>\n      </div>\n    </div>\n  </template>\n  \n  <script>\n  import { reactive, ref, toRefs, onMounted } from 'vue'\n\n  import { version } from '../../package.json'\n  import { useRouter } from 'vue-router'\n  \n  export default {\n    name: 'Login',\n    setup() {\n      const router = useRouter()\n      const state = reactive({\n        version: version,\n        \n        username: '',\n        password: {\n          visible: false,\n          value: ''\n        },\n        errorVisible: false,\n        globalData: {\n          currentUser: null\n        },\n      })\n  \n      onMounted(() => {\n        \n      })\n  \n  \n      const switchPasswordVisible = () => {\n        state.password.visible = !state.password.visible\n      }\n  \n      const login = async () => {\n        if (state.username.trim() !== '' && state.password.value.trim() !== '') {\n        try {\n                const response = await axios.post(\"http://localhost:8000/login\", {\n                username: username,\n                password: password.value,\n            });\n            console.log(response.data);\n            localStorage.setItem('user', JSON.stringify(response.data));\n            connectSocket(response.data.id);\n            router.replace({ path: './conversations' })\n        } catch (error) {\n            state.errorVisible = true\n        }\n        }      \n      }\n\n      const connectSocket = (userId) => {\n      socket = new WebSocket(\"ws://localhost:8000/ws/\" + userId);\n\n      socket.onopen = () => {\n        console.log(\"success!\")\n      }\n      socket.onmessage = (event) => {\n        console.log(\"Message from server: \", event.data);\n        receiveMessage.value += event.data;\n      };\n      socket.onclose = (event) => {\n        console.log(\"Socket closed\", event);\n      };\n    };\n  \n      return {\n        ...toRefs(state),\n        switchPasswordVisible,\n        login\n      }\n    }\n  }\n  </script>\n  "],"mappings":"AA2BE,SAASA,QAAQ,EAAEC,GAAG,EAAEC,MAAM,EAAEC,SAAQ,QAAS,KAAI;AAErD,SAASC,OAAM,QAAS,oBAAmB;AAC3C,SAASC,SAAQ,QAAS,YAAW;AAErC,eAAe;EACbC,IAAI,EAAE,OAAO;EACbC,KAAKA,CAAA,EAAG;IACN,MAAMC,MAAK,GAAIH,SAAS,CAAC;IACzB,MAAMI,KAAI,GAAIT,QAAQ,CAAC;MACrBI,OAAO,EAAEA,OAAO;MAEhBM,QAAQ,EAAE,EAAE;MACZC,QAAQ,EAAE;QACRC,OAAO,EAAE,KAAK;QACdC,KAAK,EAAE;MACT,CAAC;MACDC,YAAY,EAAE,KAAK;MACnBC,UAAU,EAAE;QACVC,WAAW,EAAE;MACf;IACF,CAAC;IAEDb,SAAS,CAAC,MAAM,CAEhB,CAAC;IAGD,MAAMc,qBAAoB,GAAIA,CAAA,KAAM;MAClCR,KAAK,CAACE,QAAQ,CAACC,OAAM,GAAI,CAACH,KAAK,CAACE,QAAQ,CAACC,OAAM;IACjD;IAEA,MAAMM,KAAI,GAAI,MAAAA,CAAA,KAAY;MACxB,IAAIT,KAAK,CAACC,QAAQ,CAACS,IAAI,CAAC,MAAM,EAAC,IAAKV,KAAK,CAACE,QAAQ,CAACE,KAAK,CAACM,IAAI,CAAC,MAAM,EAAE,EAAE;QACxE,IAAI;UACI,MAAMC,QAAO,GAAI,MAAMC,KAAK,CAACC,IAAI,CAAC,6BAA6B,EAAE;YACjEZ,QAAQ,EAAEA,QAAQ;YAClBC,QAAQ,EAAEA,QAAQ,CAACE;UACvB,CAAC,CAAC;UACFU,OAAO,CAACC,GAAG,CAACJ,QAAQ,CAACK,IAAI,CAAC;UAC1BC,YAAY,CAACC,OAAO,CAAC,MAAM,EAAEC,IAAI,CAACC,SAAS,CAACT,QAAQ,CAACK,IAAI,CAAC,CAAC;UAC3DK,aAAa,CAACV,QAAQ,CAACK,IAAI,CAACM,EAAE,CAAC;UAC/BvB,MAAM,CAACwB,OAAO,CAAC;YAAEC,IAAI,EAAE;UAAkB,CAAC;QAC9C,EAAE,OAAOC,KAAK,EAAE;UACZzB,KAAK,CAACK,YAAW,GAAI,IAAG;QAC5B;MACA;IACF;IAEA,MAAMgB,aAAY,GAAKK,MAAM,IAAK;MAClCC,MAAK,GAAI,IAAIC,SAAS,CAAC,yBAAwB,GAAIF,MAAM,CAAC;MAE1DC,MAAM,CAACE,MAAK,GAAI,MAAM;QACpBf,OAAO,CAACC,GAAG,CAAC,UAAU;MACxB;MACAY,MAAM,CAACG,SAAQ,GAAKC,KAAK,IAAK;QAC5BjB,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEgB,KAAK,CAACf,IAAI,CAAC;QAChDgB,cAAc,CAAC5B,KAAI,IAAK2B,KAAK,CAACf,IAAI;MACpC,CAAC;MACDW,MAAM,CAACM,OAAM,GAAKF,KAAK,IAAK;QAC1BjB,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEgB,KAAK,CAAC;MACrC,CAAC;IACH,CAAC;IAEC,OAAO;MACL,GAAGtC,MAAM,CAACO,KAAK,CAAC;MAChBQ,qBAAqB;MACrBC;IACF;EACF;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}